<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:YuvaCep.Mobile.ViewModels"
             xmlns:converters="clr-namespace:YuvaCep.Mobile.Converters"
             xmlns:enums="clr-namespace:YuvaCep.Mobile.Enums"
             x:Class="YuvaCep.Mobile.Views.TeacherDailyReportPage"
             Title="Rapor Ekle"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource PageBackgroundColor}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:EnumToStringConverter x:Key="EnumConverter"/>
            <converters:IsNullConverter x:Key="IsNullConverter"/>
            <converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *">

        <Grid Grid.Row="0" HeightRequest="180">
            <BoxView Color="{StaticResource PrimaryColor}" 
                     CornerRadius="0,0,60,60"
                     VerticalOptions="Fill"/>

            <Grid ColumnDefinitions="Auto, *" Padding="20,50,20,0" VerticalOptions="Start">
                <Frame Padding="0" HeightRequest="40" WidthRequest="40" CornerRadius="12" 
                       BackgroundColor="#33FFFFFF" HasShadow="False" BorderColor="Transparent"
                       HorizontalOptions="Start">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoBackCommand}"/>
                    </Frame.GestureRecognizers>
                    <Label Text="&#x2190;" TextColor="White" FontSize="24" HorizontalOptions="Center" VerticalOptions="Center"/>
                </Frame>

                <Label Grid.Column="1" Text="Rapor OluÅŸtur" 
                       TextColor="White" FontSize="22" FontAttributes="Bold" 
                       HorizontalOptions="Center" VerticalOptions="Center" Margin="-40,0,0,0"/>
            </Grid>
        </Grid>

        <ScrollView Grid.Row="1" Margin="0,-60,0,0" Padding="0,0,0,30" VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Spacing="20">

                <CollectionView ItemsSource="{Binding Students}" 
                                SelectionMode="None" 
                                HeightRequest="120"
                                Margin="20,0">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Horizontal" ItemSpacing="15"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="0" HasShadow="True" CornerRadius="15" HeightRequest="100" WidthRequest="80">
                                <Frame.Triggers>
                                    <DataTrigger TargetType="Frame" Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BackgroundColor" Value="#F3E8FF"/> <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Frame" Binding="{Binding IsSelected}" Value="False">
                                        <Setter Property="BackgroundColor" Value="White"/>
                                        <Setter Property="BorderColor" Value="Transparent"/>
                                    </DataTrigger>
                                </Frame.Triggers>

                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TeacherDailyReportViewModel}}, Path=SelectStudentCommand}"
                                                          CommandParameter="{Binding .}"/>
                                </Frame.GestureRecognizers>

                                <VerticalStackLayout VerticalOptions="Center" Spacing="5">
                                    <Frame HeightRequest="50" WidthRequest="50" CornerRadius="25" Padding="0" 
                                           BackgroundColor="#E0E7FF" HasShadow="False" HorizontalOptions="Center" BorderColor="Transparent">
                                        <Label Text="ðŸ‘¶" FontSize="24" HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Frame>
                                    <Label Text="{Binding Name}" FontSize="12" FontAttributes="Bold" 
                                           TextColor="{StaticResource PrimaryTextColor}" 
                                           HorizontalOptions="Center" HorizontalTextAlignment="Center" LineBreakMode="TailTruncation"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <VerticalStackLayout Spacing="20" Padding="20,0" 
                                     IsVisible="{Binding SelectedStudent, Converter={StaticResource IsNotNullConverter}}">

                    <Frame BackgroundColor="White" CornerRadius="20" HasShadow="True" Padding="15" BorderColor="Transparent">
                        <VerticalStackLayout Spacing="15">
                            <Label Text="ðŸ˜Š Genel Durum" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource PrimaryColor}"/>
                            
                            <Grid ColumnDefinitions="*,*,*,*,*" ColumnSpacing="10">
                                <Frame Grid.Column="0" CornerRadius="12" Padding="5" HasShadow="False">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Harika}">
                                            <Setter Property="BackgroundColor" Value="#F3E8FF"/> 
                                            <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Mutlu}"> <Setter Property="BackgroundColor" Value="Transparent"/>
                                             <Setter Property="BorderColor" Value="Transparent"/>
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SetMoodCommand}" CommandParameter="{x:Static enums:MoodStatus.Harika}"/>
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout>
                                        <Label Text="ðŸ¤©" FontSize="32" HorizontalOptions="Center"/>
                                        <Label Text="Harika" FontSize="10" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Frame>

                                <Frame Grid.Column="1" CornerRadius="12" Padding="5" HasShadow="False">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Mutlu}">
                                            <Setter Property="BackgroundColor" Value="#F3E8FF"/> 
                                            <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Harika}"> <Setter Property="BackgroundColor" Value="Transparent"/>
                                             <Setter Property="BorderColor" Value="Transparent"/>
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SetMoodCommand}" CommandParameter="{x:Static enums:MoodStatus.Mutlu}"/>
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout>
                                        <Label Text="ðŸ™‚" FontSize="32" HorizontalOptions="Center"/>
                                        <Label Text="Mutlu" FontSize="10" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Frame>

                                <Frame Grid.Column="2" CornerRadius="12" Padding="5" HasShadow="False">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Normal}">
                                            <Setter Property="BackgroundColor" Value="#F3E8FF"/> 
                                            <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Mutlu}"> <Setter Property="BackgroundColor" Value="Transparent"/>
                                             <Setter Property="BorderColor" Value="Transparent"/>
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SetMoodCommand}" CommandParameter="{x:Static enums:MoodStatus.Normal}"/>
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout>
                                        <Label Text="ðŸ˜" FontSize="32" HorizontalOptions="Center"/>
                                        <Label Text="Normal" FontSize="10" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Frame>

                                <Frame Grid.Column="3" CornerRadius="12" Padding="5" HasShadow="False">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Uzgun}">
                                            <Setter Property="BackgroundColor" Value="#F3E8FF"/> 
                                            <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Mutlu}"> <Setter Property="BackgroundColor" Value="Transparent"/>
                                             <Setter Property="BorderColor" Value="Transparent"/>
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SetMoodCommand}" CommandParameter="{x:Static enums:MoodStatus.Uzgun}"/>
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout>
                                        <Label Text="â˜¹ï¸" FontSize="32" HorizontalOptions="Center"/>
                                        <Label Text="ÃœzgÃ¼n" FontSize="10" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Frame>

                                <Frame Grid.Column="4" CornerRadius="12" Padding="5" HasShadow="False">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.CokUzgun}">
                                            <Setter Property="BackgroundColor" Value="#F3E8FF"/>
                                            <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Frame" Binding="{Binding SelectedMood}" Value="{x:Static enums:MoodStatus.Uzgun}">
                                            <Setter Property="BackgroundColor" Value="Transparent"/>
                                            <Setter Property="BorderColor" Value="Transparent"/>
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SetMoodCommand}" CommandParameter="{x:Static enums:MoodStatus.CokUzgun}"/>
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout>
                                        <Label Text="ðŸ˜­" FontSize="32" HorizontalOptions="Center"/>
                                        <Label Text="Ã‡ok ÃœzgÃ¼n" FontSize="10" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </Grid>

                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10,0" HeightRequest="50" HasShadow="False">
                                <Entry Placeholder="Mod notu ekle..." Text="{Binding MoodNote}" PlaceholderColor="#9CA3AF" TextColor="Black"/>
                            </Frame>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame BackgroundColor="White" CornerRadius="20" HasShadow="True" Padding="15" BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ½ï¸ Yemek Durumu" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource PrimaryColor}"/>

                            <Label Text="KahvaltÄ±" FontSize="12" TextColor="Gray"/>
                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10,0" HeightRequest="50" HasShadow="False">
                                <Picker Title="SeÃ§iniz" ItemsSource="{Binding FoodList}" SelectedItem="{Binding SelectedBreakfast}"
                                        ItemDisplayBinding="{Binding ., Converter={StaticResource EnumConverter}}"
                                        TextColor="Black"/>
                            </Frame>

                            <Label Text="Ã–ÄŸle YemeÄŸi" FontSize="12" TextColor="Gray"/>
                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10,0" HeightRequest="50" HasShadow="False">
                                <Picker Title="SeÃ§iniz" ItemsSource="{Binding FoodList}" SelectedItem="{Binding SelectedLunch}"
                                        ItemDisplayBinding="{Binding ., Converter={StaticResource EnumConverter}}"
                                        TextColor="Black"/>
                            </Frame>

                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10,0" HeightRequest="50" HasShadow="False">
                                <Entry Placeholder="Yemek notu..." Text="{Binding FoodNote}" PlaceholderColor="#9CA3AF" TextColor="Black"/>
                            </Frame>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame BackgroundColor="White" CornerRadius="20" HasShadow="True" Padding="15" BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ˜´ Uyku &amp; Etkinlik" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource PrimaryColor}"/>
                            
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="Uyku" FontSize="12" TextColor="Gray"/>
                                    <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="5,0" HeightRequest="50" HasShadow="False">
                                        <Picker Title="SeÃ§" ItemsSource="{Binding SleepList}" SelectedItem="{Binding SelectedSleep}"
                                                ItemDisplayBinding="{Binding ., Converter={StaticResource EnumConverter}}"
                                                TextColor="Black"/>
                                    </Frame>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="Etkinlik" FontSize="12" TextColor="Gray"/>
                                    <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="5,0" HeightRequest="50" HasShadow="False">
                                        <Picker Title="SeÃ§" ItemsSource="{Binding ActivityList}" SelectedItem="{Binding SelectedActivity}"
                                                ItemDisplayBinding="{Binding ., Converter={StaticResource EnumConverter}}"
                                                TextColor="Black"/>
                                    </Frame>
                                </VerticalStackLayout>
                            </Grid>

                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10,0" HeightRequest="50" HasShadow="False">
                                <Entry Placeholder="Etkinlik notu..." Text="{Binding ActivityNote}" PlaceholderColor="#9CA3AF" TextColor="Black"/>
                            </Frame>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame BackgroundColor="White" CornerRadius="20" HasShadow="True" Padding="15" BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ“ Ã–ÄŸretmen Notu" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource PrimaryColor}"/>
                            <Frame BackgroundColor="#F9FAFB" BorderColor="#E5E7EB" CornerRadius="12" Padding="10" HeightRequest="100" HasShadow="False">
                                <Editor Placeholder="Veliye iletmek istediÄŸiniz not..." Text="{Binding TeacherNote}" 
                                        PlaceholderColor="#9CA3AF" TextColor="Black" AutoSize="TextChanges"/>
                            </Frame>
                        </VerticalStackLayout>
                    </Frame>

                    <Button Text="RAPORU KAYDET" 
                            Command="{Binding SaveReportCommand}"
                            BackgroundColor="{StaticResource PrimaryColor}"
                            TextColor="White"
                            CornerRadius="15"
                            FontAttributes="Bold"
                            FontSize="16"
                            HeightRequest="55"
                            Margin="0,10,0,20"
                            Shadow="{Shadow Radius=10, Opacity=0.2}"/>

                </VerticalStackLayout>
                
                <Label Text="LÃ¼tfen rapor girmek iÃ§in yukarÄ±dan bir Ã¶ÄŸrenci seÃ§iniz." 
                       TextColor="Gray" HorizontalOptions="Center" 
                       IsVisible="{Binding SelectedStudent, Converter={StaticResource IsNullConverter}}"
                       Margin="0,50,0,0"/>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>